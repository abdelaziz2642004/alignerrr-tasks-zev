The implementation is complete. Here's a summary of the changes made:

  Summary of Changes

  1. src/zev/llms/types.py - Extended data models

  - Added WorkflowStep class with fields: step_number, command, short_explanation, is_dangerous,
  dangerous_explanation, depends_on_previous
  - Added Workflow class with workflow_description and steps list
  - Added optional workflow field to OptionsResponse

  2. src/zev/constants.py - Updated LLM prompt

  - Added detailed instructions for when to return a workflow vs individual commands
  - Documented the workflow schema (steps with dependencies)
  - Provided guidance on when workflows are appropriate (sequential tasks, dependent commands)

  3. src/zev/llms/gemini/provider.py - Updated Gemini JSON schema

  - Extended GEMINI_RESPONSE_SCHEMA to include the workflow object structure with all required fields

  4. src/zev/workflow_executor.py - New module for workflow execution

  - show_workflow() - Displays workflow summary and prompts user to execute
  - display_workflow_summary() - Shows all steps with danger indicators and dependencies
  - execute_workflow() - Executes steps sequentially with:
    - Dependency checking (skips steps if previous dependent step failed)
    - Dangerous step confirmation
    - Per-step execution confirmation
    - Continue/abort prompts on failure
  - display_execution_summary() - Shows completion statistics

  5. src/zev/main.py - Handle workflow responses

  - Added import for show_workflow
  - Added workflow detection in get_options() - checks if response has a workflow and routes to workflow
  executor

  6. src/zev/command_history.py - Workflow history support

  - Added import for show_workflow
  - Updated show_history() to replay workflows from history

  Key Features:

  - Backward compatible - Single commands still work as before
  - Dependency tracking - Steps can depend on previous steps succeeding
  - Dangerous step handling - Each dangerous step requires explicit confirmation
  - Interactive execution - User can skip steps or abort the workflow
  - History support - Workflows are saved and can be replayed from history
  - Execution summary - Shows completed/failed/skipped steps after workflow runs